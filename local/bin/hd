#!/usr/local/bin/zsh

VERSION="2.5.1"

export HADOOP_HOME=$HOME/hadoop/hadoop-$VERSION
export HADOOP_MAPRED_HOME=$HADOOP_HOME
export HADOOP_COMMON_HOME=$HADOOP_HOME
export HADOOP_HDFS_HOME=$HADOOP_HOME
export YARN_HOME=$HADOOP_HOME
export HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop

export PATH=$HOME/hadoop/hadoop-$VERSION/bin:$HOME/hadoop/hadoop-$VERSION/sbin:$HOME/spark/spark-1.1.0-bin-hadoop2.4/bin:$HOME/spark/spark-1.1.0-bin-hadoop2.4/sbin:$PATH

export LD_LIBRARY_PATH=$HOME/hadoop/hadoop-$VERSION/lib/native:$LD_LIBRARY_PATH

#export JAVA_LIBRARY_PATH==$HOME/hadoop/hadoop-$VERSION/lib/native:$JAVA_LIBRARY_PATH

# export JAVA_HOME=$(/usr/libexec/java_home -v 1.7)

export CLASSPATH=`yarn classpath`:./:$CLASSPATH

# for RHadoop
export HADOOP_CMD=$HOME/hadoop/hadoop-$VERSION/bin/hadoop
export HADOOP_STREAMING=$HOME/hadoop/hadoop-$VERSION/contrib/streaming/hadoop-streaming-$VERSION.jar
#export HADOOP_HOME=$HOME/hadoop/hadoop-$VERSION

# -----------------------
export HADOOP_OPTS="-Djava.security.krb5.realm=-Djava.security.krb5.kdc="
# alias java='java -Dapple.awt.UIElement="true"'

# #export HADOOP_OPTS="-Djava.security.krb5.realm= -Djava.security.krb5.kdc="
# #export HADOOP_OPTS="-Djava.security.krb5.realm=OX.AC.UK -Djava.security.krb5.kdc=kdc0.ox.ac.uk:kdc1.ox.ac.uk"
# #export YARN_OPTS="$YARN_OPTS -Djava.security.krb5.realm=OX.AC.UK -Djava.security.krb5.kdc=kdc0.ox.ac.uk:kdc1.ox.ac.uk"
#
# export JAVA_OPTS=-Xmx768m
# export HADOOP_OPTS="-Djava.security.krb5.realm=OX.AC.UK -Djava.security.krb5.kdc=kdc0.ox.ac.uk:kdc1.ox.ac.uk"

# For lingual
# export PATH=~/.lingual-client/bin/:$PATH
# export HADOOP_HOME=$HOME/hadoop/hadoop-$VERSION
export HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop
# export HADOOP_USER_NAME=hqian

command=$@
if [ "$command" = 'start' ]
then
    echo -e "\x1b[1m \x1b[33m  -- Starting HADOOP $VERSION in ~/hadoop ... \x1b[00m"
    hadoop-daemon.sh start namenode
    hadoop-daemon.sh start datanode
    hadoop-daemon.sh start secondarynamenode
    yarn-daemon.sh start resourcemanager
    yarn-daemon.sh start nodemanager
    mr-jobhistory-daemon.sh start historyserver
elif [ "$command" = 'stop' ]
then
    echo -e "\x1b[1m \x1b[33m  -- Stopping HADOOP $VERSION in ~/hadoop ... \x1b[00m"
    hadoop-daemon.sh stop namenode
    hadoop-daemon.sh stop datanode
    hadoop-daemon.sh stop secondarynamenode
    yarn-daemon.sh stop resourcemanager
    yarn-daemon.sh stop nodemanager
    mr-jobhistory-daemon.sh stop historyserver
elif [ "$1" = 'fs' ] || [ "$1" = "jar" ] || [[ "$1" == -* ]]
then
    echo -e "\x1b[1m \x1b[33m  -- HADOOP $VERSION in ~/hadoop \x1b[00m"
    n=1
    for var in $@
    do
        if [ $n -eq 1 ]
        then
            if [ "$1" = 'fs' ]
            then
                command="hdfs dfs"
            elif [[ "$1" == -* ]]
            then
                command="hdfs dfs $1"
            else
                command="hadoop jar"
            fi
        else
            command="$command $var"
        fi
        n=$[n+1]
    done
    eval $command
else
    echo -e "\x1b[1m \x1b[33m  -- HADOOP $VERSION in ~/hadoop \x1b[00m"
    eval $@
fi


